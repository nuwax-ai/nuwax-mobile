<template>
	<view class="container">
		<!-- 导航栏 -->
		<custom-nav-bar :title="currentName" show-back />
		<view class="content">
			<!-- 头部区域 -->
			<view class="header-section">
				<view class="icon-container">
					<image class="title-icon" :src="agentInfo?.icon" mode="aspectFit"></image>
				</view>
				<view class="title-section">
					<text class="main-title">{{agentInfo?.name}}</text>
					<text class="subtitle">{{agentInfo?.description}}</text>
				</view>
				<!-- 功能按钮区域 -->
				<button-wrapper :buttons="agentInfo?.openingGuidQuestions || []" @button-click="handleButtonClick" />
			</view>
		</view>
	</view>
</template>

<script setup lang="uts">
	import { ref,Ref } from 'vue'
	import { SUCCESS_CODE } from '@/constants/codes.constants';
	import { apiPublishedAgentInfo } from '@/servers/agentDev'

	const currentId = ref('')
	const currentName = ref('')
	const agentInfo = ref({})

	onLoad(async (params) => {
		currentId.value = params.id || ''
		currentName.value = params.name || ''
		getPublishedAgentInfo() // 获取发布信息
	})

	// 获取发布信息
	const getPublishedAgentInfo = async () => {
		const { code, data } = await apiPublishedAgentInfo(Number(currentId.value))
		if (code === SUCCESS_CODE) {
			agentInfo.value = data
		}
	}

	// 处理功能按钮点击
	const handleButtonClick = (buttonText : string) => {
		// 这里可以添加具体的功能逻辑
		uni.showToast({
			title: `点击了${buttonText}`,
			icon: 'none'
		})
	}
</script>

<style lang="scss" scoped>
	.container {
		height: 100%;
		display: flex;
		flex-direction: column;

		.content {
			flex: 1;
			overflow: auto;
			padding: 32rpx;

			.header-section {
				margin: 170rpx 0;

				.icon-container {
					margin: 0 auto;
					width: 160rpx;
					height: 160rpx;
					border-radius: 25rpx;
					flex-shrink: 0;

					.title-icon {
						width: 160rpx;
						height: 160rpx;
						border-radius: 25rpx;
					}
				}

				.title-section {
					margin-bottom: 40rpx;

					.main-title {
						margin: 20rpx 20rpx 40rpx;
						font-size: 48rpx;
						line-height: 64rpx;
						font-weight: 600;
						color: rgba(21, 23, 31, 1);
						text-align: center;
					}

					.subtitle {
						font-size: 28rpx;
						text-align: center;
						color: rgba(21, 23, 31, 0.7);
						line-height: 44rpx;
						max-height: 84rpx;
						overflow: hidden;
						text-overflow: ellipsis;
						display: -webkit-box;
						-webkit-line-clamp: 2;
						-webkit-box-orient: vertical;
					}
				}
			}

		}
	}
</style>