<!DOCTYPE html>
<html lang="zh-CN">

<head>
	<meta charset="UTF-8" />
	<script>
		var coverSupport = 'CSS' in window && typeof CSS.supports === 'function' && (CSS.supports('top: env(a)') ||
			CSS.supports('top: constant(a)'))
		document.write(
			'<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0' +
			(coverSupport ? ', viewport-fit=cover' : '') + '" />')
	</script>
	<title></title>
	<!-- #ifdef H5 || WEB -->
	<!--2.阿里云验证码-集成主JS-->
    <script defer type="text/javascript" src="https://o.alicdn.com/captcha-frontend/aliyunCaptcha/AliyunCaptcha.js"></script>
	<!-- #endif -->
	<!--preload-links-->
	<!--app-context-->
	<script>
			(function () {
				if (typeof window === 'undefined') {
					return;
				}

				// 开发模式检测 - 如果是开发环境则不执行跳转
				if (typeof process !== 'undefined' && process.env && process.env.NODE_ENV === 'development') {
					console.log('开发模式检测到，跳过双向跳转逻辑');
					return;
				}

				// const isChatTempPage = window.location.pathname.includes('/chat-temp/');
				// if (isChatTempPage) { // 临时会话页面不进行跳转
				// 	return;
				// }

				const { protocol, host, href, hash } = window.location;
				const isMobile = /Android|iPhone|iPad|iPod|Mobile|Tablet/i.test(navigator.userAgent);
				const baseUrl = protocol + '//' + host;

				// PC 端访问 M 页面 => 跳转 PC
				if (!isMobile && href.includes('/m/')) {
					if (hash && hash.indexOf("#/pages/agent-detail/agent-detail") !== -1) {
						const match = hash.match(/[?&]id=([^&#]+)/);
						if (match && match[1]) {
							const agentId = match[1];
							window.location.replace(baseUrl + '/agent/' + agentId);
							return;
						}
					}
					window.location.replace(baseUrl + '/');
					return;
				}

				// 移动端访问 PC 页面 => 跳转 M
				if (isMobile && !href.includes('/m/')) {
					const match = href.match(/\/agent\/([^/?#]+)/);
					if (match) {
						const agentId = match[1];
						window.location.replace(baseUrl + '/m/#/pages/agent-detail/agent-detail?id=' + agentId);
						return;
					}
					window.location.replace(baseUrl + '/m/');
					return;
				}

				// 临时会话页面: PC 端访问 M 页面 => 跳转 PC
				if (!isMobile && href.includes('/m/')) {
					if (hash && hash.indexOf("#/pages/chat-temp/chat-temp") !== -1) {
						const match = hash.match(/[?&]chatKey=([^&#]+)/);
						if (match && match[1]) {
							const chatKey = match[1];
							window.location.replace(baseUrl + '/chat-temp/' + chatKey);
							return;
						}
					}
					window.location.replace(baseUrl + '/');
					return;
				}

				// 临时会话页面: 移动端访问 PC 页面 => 跳转 M
				if (isMobile && !href.includes('/m/')) {
					const match = href.match(/\/chat-temp\/([^/?#]+)/);
					if (match) {
						const chatKey = match[1];
						window.location.replace(baseUrl + '/m/#/pages/chat-temp/chat-temp?chatKey=' + chatKey);
						return;
					}
					window.location.replace(baseUrl + '/m/');
					return;
				}
			})();
	</script>
</head>

<body>
	<div id="app"><!--app-html--></div>
	<script type="module" src="/main"></script>
</body>

</html>