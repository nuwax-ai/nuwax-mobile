<template>
  <view class="sidebar">
    <!-- 用户信息 -->
    <view class="user-info" @click="onUserClick">
      <image :src="user.avatar" class="avatar" mode="aspectFill"></image>
      <text class="nickname">{{ user.nickname }}</text>
    </view>

    <!-- 菜单 -->
    <view class="menu">
      <view
        class="menu-item"
        v-for="(item, index) in menuList"
        :key="index"
        @click="onMenuClick(item)"
      >
        <uni-icons v-if="item.icon" class="iconfont" :class="item.icon"  size="40rpx"></uni-icons>
        <text class="menu-text">{{ item.text }}</text>
        <uni-icons v-if="item.icon" class="menu-icon iconfont icon-a-Chevronright"  size="40rpx"></uni-icons>
      </view>
    </view>

    <!-- 最近使用 -->
    <view class="section">
      <text class="section-title">最近使用</text>
      <view
        class="recent-item"
        v-for="(item, index) in recentList"
        :key="index"
        @click="onRecentClick(item)"
      >
        <image v-if="item.icon" :src="item.icon" class="recent-icon"/>
        <text class="recent-text">{{ item.text }}</text>
      </view>
    </view>

    <!-- 会话记录 -->
    <view class="session-recording">
      <view class="section-header">
        <view class="section-title">会话记录</view>
        <view class="more" @click="onViewAll('conversation-record')">
          <view class="text">查看全部</view>
          <uni-icons class="iconfont icon-a-Chevronright"  size="32rpx"></uni-icons>
        </view>
      </view>
      <view
        class="chat-item"
        v-for="(item, index) in chatList"
        :key="index"
        @click="onChatClick(item)"
      >
        <text class="chat-text">{{ item.text }}</text>
      </view>
    </view>
  </view>
</template>

<script setup lang="uts">
import {reactive} from "vue";
// 定义自定义事件
const emit = defineEmits<{
  // 查看全部事件
  'view-all': [type: string]
  // 菜单点击事件
  'menu-click': [item: {text: string, icon: string}]
  // 最近使用点击事件
  'recent-click': [item: {text: string, icon: string}]
  // 会话记录点击事件
  'chat-click': [item: {text: string}]
  // 用户信息点击事件
  'user-click': [user: {avatar: string, nickname: string}]
}>()

const user = reactive<{avatar: string, nickname: string}>({
  avatar: "/static/logo.png",
  nickname: "aMos"
});

const menuList = reactive<{text: string, icon: string}[]>([
  {text: "首页", icon: "icon-Home"},
  {text: "智能体", icon: "icon-stars"}
]);

const recentList = reactive<{text: string, icon: string}[]>([
  {text: "Mermaid转换器", icon: "/static/logo.png"},
  {text: "Ollama", icon: "/static/logo.png"}
]);

const chatList = reactive<{text: string}[]>([
  {text: "Ai for UX design"},
  {text: "稳定币的价值分析"},
  {text: "比特币投资建议"}
]);

// 菜单点击处理
const onMenuClick = (item: {text: string, icon: string}) => {
  console.log("点击菜单：", item);
  emit('menu-click', item);
  // 保留原有的导航逻辑
  uni.navigateTo({
    url: `/pages/agent-list/agent-list`
  })
};

// 最近使用点击处理
const onRecentClick = (item: {text: string, icon: string}) => {
  console.log("点击最近使用：", item);
  emit('recent-click', item);
};

// 会话记录点击处理
const onChatClick = (item: {text: string}) => {
  console.log("点击会话记录：", item);
  emit('chat-click', item);
};

// 查看全部处理
const onViewAll = (type: string) => {
  emit('view-all', type);
};

// 用户信息点击处理
const onUserClick = () => {
  console.log("点击用户信息：", user);
  emit('user-click', user);
};
</script>

<style lang="scss" scoped>
.sidebar {
  width: 100%;
  background-color: #fff;
  box-sizing: border-box;
  display: flex;
  flex-direction: column;

  .user-info {
    display: flex;
    flex-direction: row;
    align-items: center;
    margin-bottom: 40rpx;

    .avatar {
      width: 100rpx;
      height: 100rpx;
      border-radius: 50%;
      margin-right: 20rpx;
    }

    .nickname {
      font-size: 36rpx;
      font-weight: bold;
    }
  }

  .menu {
    margin-bottom: 40rpx;

    .menu-item {
      display: flex;
      flex-direction: row;
      align-items: center;
      padding: 16rpx 0;

      .menu-icon {
        width: 40rpx;
        height: 40rpx;
        margin-right: 16rpx;
      }

      .menu-text {
        font-size: 26rpx;
        margin-left: 10rpx;
        flex: 1;
        color: #15171F;
      }
    }
  }

  .section {
    margin-bottom: 30rpx;

    .section-title {
      font-size: 28rpx;
      font-weight: bold;
      margin-bottom: 10rpx;
      color: rgba(21, 23, 31, 0.5);
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }


    .recent-item {
      display: flex;
      flex-direction: row;
      align-items: center;
      margin: 20rpx 0;

      .recent-icon {
        width: 60rpx;
        height: 60rpx;
        margin-right: 20rpx;
        border-radius: 15rpx;
      }

      .chat-text {
        flex: 1;
        font-size: 24rpx;
        color: rgba(21, 23, 31, 0.7);
      }
    }
  }

  .session-recording {
    .section-header {
      display: flex;
      flex-direction: row;
      justify-content: space-between;
      align-items: center;

      .section-title {
        flex: 1;
        font-size: 28rpx;
        font-weight: bold;
        margin-bottom: 10rpx;
        color: rgba(21, 23, 31, 0.5);
      }

      .more {

        display: flex;
        flex-direction: row;
        align-items: center;

        .text {
          font-size: 24rpx;
          font-weight: bold;
          color: rgba(21, 23, 31, 0.5);
        }
      }
    }

    .chat-item {
      padding: 20rpx 0;
      color: rgba(64, 69, 82, 1);
    }
  }
}


</style>
