<template>
    <x-dropdown @open="onOpen" @close="onClose">
      <view class="trigger">
        <text class="iconfont icon-Menu"></text>
      </view>
  
      <template #menu>
        <view class="custom-menu">
          <view class="custom-menu-item" @click="handleCustomClick('add')">
            <text class="iconfont icon-message-add" ></text>
            <text class="menu-text">新建会话</text>
          </view>
          <view class="custom-menu-item" @click="handleCustomClick('info')">
            <text class="iconfont icon-Info" ></text>
            <text class="menu-text">更多信息</text>
          </view>
          <view class="custom-menu-item" @click="handleCustomClick('collect')">
            <text class="iconfont icon-Star" v-if="!agentInfo?.collect"/>
            <text class="iconfont icon-Star-fill" v-else/>
            <text class="menu-text">收藏</text>
          </view>
          <!-- <view class="custom-menu-item" @click="handleCustomClick('close')">
            <text class="iconfont icon-Exit" ></text>
            <text class="menu-text">关闭</text>
          </view> -->
        </view>
      </template>
    </x-dropdown>
  </template>
  
  <script setup lang="uts">
    import type { AgentDetailDto } from '@/types/interfaces/agent'


    interface Props{
        agentInfo: AgentDetailDto
    }

    // 接收组件属性，设置默认值
    const props = withDefaults(defineProps<Props>(), {
    })

    // 定义事件
    const emit = defineEmits(['add','info','collect','close'])
    const dropdown = ref<any>(null)

    const customMenuList = ref<any[]>([
        { label: '新建会话', icon: 'icon-message-add' },
        { label: '更多信息', icon: 'icon-Info' },
        { label: '收藏', icon: 'icon-Star' },
        { label: '关闭', icon: 'icon-Exit' }
    ])

    const onOpen = () => {
        // console.log('菜单打开')
    }

    const onClose = () => {
        // console.log('菜单关闭')
    }

    const handleCustomClick = (type: string) => {
        switch (type) {
            case 'add':
                emit('add')
                break;
            case 'info':
                emit('info')
                break;
            case 'collect':
                emit('collect')
            case value:
                emit('close')
                break;

            default:
                break;
        }
        // 手动关闭菜单
        // dropdown.value?.close()
    }
        
    defineExpose({
        dropdown
    })
  </script>
  
  <style lang="scss" scoped>

    .trigger{
        .iconfont {
            font-size: 50rpx;
            color: #333;
        }
    }


  .custom-menu {
    background: white;
    border-radius: 8rpx;
    box-shadow: 0 2rpx 20rpx rgba(0,0,0,0.1);
    border: 2rpx solid #eee;
    overflow: hidden;
    padding: 0rpx 16rpx;


    .custom-menu-item {
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: flex-start;
        padding: 16rpx 0;
        gap: 8rpx;
        border-bottom: 2rpx solid #eee;

        .iconfont {
            font-size: 32rpx;
            color: #333;
        }

        .menu-text {
            font-size: 28rpx;
            color: #333;
        }

        .icon-Star-fill {
            color: #faad14;
        }

        &:active {
            background: #f0f0f0;
        }
    }

  }
  

  

  

  
//   .menu-icon {
//     width: 20rpx;
//     height: 20rpx;
//     margin-right: 12rpx;
//   }
  

  </style>