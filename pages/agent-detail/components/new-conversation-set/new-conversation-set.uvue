<template>
    <view class="variables-box flex flex-col" v-if="variables?.length">
        <view
          class="header flex items-center content-between"
        >
            <text>对话设置</text>
            <text v-if="isFilled" class='text' @click="setIsOpen(!isOpen)">
                <!-- <uni-icons class="iconfont icon-a-Chevronright down-icon" :class="{!isOpen ? 'rotate-90' : ''}" size="32rpx" color="#898a8e" /> -->
            </text>
        </view>
        <view class="conversation-container">
          <form
            class="form-box"
            :disabled="disabled"
            @submit="onFormSubmit"
          >
          <!-- <view class="uni-form-item">
            <text class="title">姓名</text>
            <input class="uni-input" name="nickname" :value="nickname" placeholder="请输入姓名" maxlength="-1" />
          </view> -->
          <template v-for="item in variables" :key="item.name">
            <view class="uni-form-item">
              <text>{{ item.displayName }}</text>
              <template v-if="item.require">
                <text>*</text>
              </template>
            </view>
            <input
                :placeholder="item.description || '请输入'"
            />
            <!-- {{ getContent(item).content }} -->
          </template>
            <!-- {{variables?.map((item: BindConfigWithSub) => {
              const { name, displayName, require, key } = item;
              const { isSelect, content } = getContent(item);
              return (
                <Form.Item
                  key={key}
                  name={name}
                  label={displayName}
                  rules={[
                    {
                      required: require,
                      message: `请${isSelect ? '选择' : '输入'}${displayName}`,
                    },
                  ]}
                >
                  {content}
                </Form.Item>
              );
            })} -->
            <button type="primary" htmlType="submit" block v-if="showSubmitButton">
                开始对话
            </button>
          </form>
          <view v-if="disabled">
            <text class="desc">对话开始后，对话设置将无法修改。</text>
          </view>
        </view>
    </view>
</template>

<script setup lang="uts">
    import { BindConfigWithSub } from '@/types/interfaces/common';
    import { InputTypeEnum } from '@/types/enums/common';
    import lCascader from '@/uni_modules/lime-cascader/components/l-cascader/l-cascader.uvue';

    const props = defineProps({
        variables: {
            type: Array as PropType<BindConfigWithSub[]>,
            default: () => [],
        },
        isFilled: {
            type: Boolean,
            default: false,
        },
        disabled: {
            type: Boolean,
            default: false,
        },
        showSubmitButton: {
            type: Boolean,
            default: false,
        },
    });

     // 是否打开表单
     const isOpen = ref(true);
     const formData = ref({});

    // const onFinish: FormProps<Record<string, string | number>>['onFinish'] = (
    // values,
    // ) => {
    //     setIsOpen(false);
    //     onConfirm?.(values);
    // };

    const onFormSubmit = (e : UniFormSubmitEvent) => {
        isOpen.value = false
        formData.value = e.detail.value
    }

    // 根据输入方式获取内容
    const getContent = (item: BindConfigWithSub) => {
        const inputType = item.inputType as InputTypeEnum;
        const description = item.description;
        // 是否单选、多选
        const isSelect = [InputTypeEnum.Select, InputTypeEnum.MultipleSelect].includes(inputType);
        let content;
        // 输入方式
        // switch (inputType) {
        //     // 单行文本
        //     case InputTypeEnum.Text:
        //         content = (
        //             <input
        //                 :placeholder="description || '请输入'"
        //             />
        //         );
        //         break;
        //     // 段落、智能识别
        //     case InputTypeEnum.Paragraph:
        //     case InputTypeEnum.AutoRecognition:
        //         content = (
        //             <textarea
        //                 :placeholder="description || '请输入'"
        //             />
        //         );
        //         break;
        //     // 数字
        //     case InputTypeEnum.Number:
        //         content = (
        //             <input
        //                 class="filled w-full"
        //                 type="number"
        //                 :placeholder="description || '请输入'"
        //             />
        //         );
        //         break;
        //     // 单选、多选
        //     case InputTypeEnum.Select:
        //     case InputTypeEnum.MultipleSelect:
        //         content = (
        //             <l-cascader 
        //             :options="item.selectConfig?.options || []" 
        //             :title="description || '请选择'" />
        //         );
        //         break;
        //     default:
        //         content = <input :placeholder="description || '请输入'" />;
        // }

        return { isSelect, content };
    };
</script>

<style lang="scss" scoped>
.variables-box {
    max-height: 50%;
    border-radius: 10rpx;
    background-color: #fff;
    border: 1px solid #e5e5e5;
    box-sizing: border-box;

    .header {
        font-weight: bold;
        padding: 18px 20px;

        .text {
        color: #95979c;
        user-select: none;

        .down-icon {
            font-size: 12px;
            transition: transform 0.3s ease-in-out;

            &.rotate-90 {
            transform: rotate(-90deg);
            }
        }
        }
    }

    .conversation-container {
        display: flex;
        flex-direction: column;
        padding-top: 20rpx;
        border-top: 1px solid #e5e5e5;
        overflow: hidden;
    }

    .close-form {
        transition: height 0.3s ease-in-out;
        height: 0;
        overflow: hidden;
    }

    .form-box {
        height: 100%;
        max-height: 400rpx;
        overflow-y: auto;
        padding: 0 20rpx;
    }

    .desc {
        line-height: 60rpx;
        padding: 0 20rpx;
        color: #e5e5e5;
    }
}
</style>