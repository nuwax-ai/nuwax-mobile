<template>
  <view class="variables-box flex flex-col" v-if="variables?.length">
    <view class="header">
      <text class="title">对话设置</text>
      <text class="iconfont icon-a-Chevrondown down-icon" :class="{'rotate-90': !isOpen}" @click="handleOpenClose" />
    </view>
    <view :class="{'close-form': !isOpen, 'conversation-container': isOpen}">
      <form
        class="form-box"
        :disabled="disabled"
        @submit="onFormSubmit"
      >
        <view class="uni-form-item" v-for="item in variables" :key="item.name">
          <view class="form-item-title">
            <text class="display-name">{{ item.displayName }}</text>
            <text v-if="item.require" class="required">*</text>
          </view>
          {{ item.inputType }}
          {{ item.inputType === InputTypeEnum.Select || item.inputType === InputTypeEnum.MultipleSelect }}
          <textarea name="item.name" v-if="item.inputType === InputTypeEnum.Paragraph" :placeholder="item.description || '请输入'" class="uni-input" placeholder-class="uni-placeholder" />
          <l-cascader
            name="item.name"
            v-else-if="item.inputType === InputTypeEnum.Select || item.inputType === InputTypeEnum.MultipleSelect" 
            :placeholder="item.description || '请选择'"
            placeholder-class="uni-placeholder" />
          <!-- <input name="item.name" v-else :placeholder="item.description || '请输入'" :type="item.inputType === InputTypeEnum.Number ? 'number' : 'text'" class="uni-input" placeholder-class="uni-placeholder" /> -->
          <input
            name="item.name"
            v-else
            :placeholder="item.description || '请输入'"
            :type="item.inputType === InputTypeEnum.Number ? 'number' : 'text'"
            class="uni-input" 
            placeholder-class="uni-placeholder"
          />
        </view>
      </form>
      <view v-if="disabled">
        <text class="desc">对话开始后，对话设置将无法修改。</text>
      </view>
    </view>
  </view>
</template>

<script setup lang="uts">
    import { BindConfigWithSub } from '@/types/interfaces/common';
    import { InputTypeEnum } from '@/types/enums/agent';
    import lCascader from '@/uni_modules/lime-cascader/components/l-cascader/l-cascader.uvue';

    const props = defineProps({
        variables: {
            type: Array as PropType<BindConfigWithSub[]>,
            default: () => [],
        },
        isFilled: {
            type: Boolean,
            default: false,
        },
        disabled: {
            type: Boolean,
            default: false,
        },
    });

     // 是否打开表单
     const isOpen = ref(true);
     const formData = ref({});

    const handleOpenClose = () => {
      isOpen.value = !isOpen.value
    }

    // const onFinish: FormProps<Record<string, string | number>>['onFinish'] = (
    // values,
    // ) => {
    //     setIsOpen(false);
    //     onConfirm?.(values);
    // };

    const onFormSubmit = (e : UniFormSubmitEvent) => {
      isOpen.value = false
      formData.value = e.detail.value
    }
</script>

<style lang="scss" scoped>
  .variables-box {
    max-height: 50%;
    border-radius: 10rpx;
    background-color: #fff;
    border: 1rpx solid #e5e5e5;
    box-sizing: border-box;
    margin: 0 32rpx;

    .header {
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: space-between;
      font-weight: bold;
      padding: 18rpx 20rpx;

      .title {
        font-size: 28rpx;
        color: #15171F;
      }

      .down-icon {
        color: #95979c;
        user-select: none;
        font-size: 32rpx;
        transition: transform 0.3s ease-in-out;

        &.rotate-90 {
          transform: rotate(-90deg);
        }
      }
    }

    .conversation-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding-top: 20rpx;
      border-top: 1rpx solid #e5e5e5;
      overflow: hidden;
    }

    .close-form {
      transition: height 0.3s ease-in-out;
      height: 0;
      overflow: hidden;
    }

    .form-box {
      height: 100%;
      max-height: 400rpx;
      overflow-y: auto;
      padding: 0 20rpx;

      .uni-form-item {
        padding: 16rpx 0;

        .form-item-title {
          display: flex;
          flex-direction: row;
          align-items: center;

          .display-name {
            font-size: 28rpx;
            color: #15171F;
          }

          .required {
            color: #FF0000;
          }
        }

        .uni-input {
          width: 100%;
          background-color: rgba(12,20,40,0.04);
          border-radius: 8rpx;
          font-size: 28rpx;
          color: #15171F;
          padding: 16rpx;
          margin-top: 8rpx;
          box-sizing: border-box;
        }

        .uni-placeholder {
          color: #6b6b75;
          font-size: 28rpx;
        }
      }
    }

    .desc {
      line-height: 60rpx;
      padding: 0 20rpx;
      color: #e5e5e5;
    }
  }
</style>