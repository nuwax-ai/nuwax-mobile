<template>
  <view class="test-cascader-page">
    <view class="header">
      <text class="title">l-cascader 组件测试</text>
    </view>
    
    <view class="test-section">
      <view class="section-title">单选模式测试</view>
      <view class="test-item">
        <button @click="showSingle = true" class="test-btn">
          打开单选级联选择器
        </button>
        <view v-if="singleValue" class="result">
          <text>选中值: {{ singleValue }}</text>
        </view>
      </view>
    </view>
    
    <view class="test-section">
      <view class="section-title">多选模式测试</view>
      <view class="test-item">
        <button @click="showMultiple = true" class="test-btn">
          打开多选级联选择器
        </button>
        <view v-if="multipleValue.length > 0" class="result">
          <text>选中值: {{ multipleValue.join(', ') }}</text>
          <text>选中数量: {{ multipleValue.length }}</text>
        </view>
      </view>
    </view>
    
    <view class="test-section">
      <view class="section-title">限制选择数量测试</view>
      <view class="test-item">
        <button @click="showLimited = true" class="test-btn">
          打开限制3个的多选级联选择器
        </button>
        <view v-if="limitedValue.length > 0" class="result">
          <text>选中值: {{ limitedValue.join(', ') }}</text>
          <text>选中数量: {{ limitedValue.length }}/3</text>
        </view>
      </view>
    </view>
    
    <!-- 单选级联选择器 -->
    <l-cascader
      :visible="showSingle"
      :options="options"
      v-model="singleValue"
      title="单选级联选择"
      placeholder="请选择地区"
      @change="onSingleChange"
      @close="showSingle = false"
      @finish="onSingleFinish"
    />
    
    <!-- 多选级联选择器 -->
    <l-cascader
      :visible="showMultiple"
      :options="options"
      :multiple="true"
      v-model:multipleValue="multipleValue"
      title="多选级联选择"
      placeholder="请选择地区"
      @change="onMultipleChange"
      @close="showMultiple = false"
      @finish="onMultipleFinish"
    />
    
    <!-- 限制选择数量的多选级联选择器 -->
    <l-cascader
      :visible="showLimited"
      :options="options"
      :multiple="true"
      :maxTagCount="3"
      v-model:multipleValue="limitedValue"
      title="限制选择数量（最多3个）"
      placeholder="请选择地区"
      @change="onLimitedChange"
      @close="showLimited = false"
      @finish="onLimitedFinish"
    />
  </view>
</template>

<script setup lang="uts">
import lCascader from '@/uni_modules/lime-cascader/components/l-cascader/l-cascader.uvue';

// 测试数据
const options = [
  {
    label: '浙江省',
    value: 'zhejiang',
    children: [
      {
        label: '杭州市',
        value: 'hangzhou',
        children: [
          { label: '西湖区', value: 'xihu' },
          { label: '余杭区', value: 'yuhang' },
          { label: '拱墅区', value: 'gongshu' }
        ]
      },
      {
        label: '宁波市',
        value: 'ningbo',
        children: [
          { label: '海曙区', value: 'haishu' },
          { label: '江北区', value: 'jiangbei' },
          { label: '鄞州区', value: 'yinzhou' }
        ]
      },
      {
        label: '温州市',
        value: 'wenzhou',
        children: [
          { label: '鹿城区', value: 'lucheng' },
          { label: '龙湾区', value: 'longwan' }
        ]
      }
    ]
  },
  {
    label: '江苏省',
    value: 'jiangsu',
    children: [
      {
        label: '南京市',
        value: 'nanjing',
        children: [
          { label: '玄武区', value: 'xuanwu' },
          { label: '鼓楼区', value: 'gulou' },
          { label: '秦淮区', value: 'qinhuai' }
        ]
      },
      {
        label: '苏州市',
        value: 'suzhou',
        children: [
          { label: '姑苏区', value: 'gusu' },
          { label: '虎丘区', value: 'huqiu' }
        ]
      }
    ]
  },
  {
    label: '广东省',
    value: 'guangdong',
    children: [
      {
        label: '广州市',
        value: 'guangzhou',
        children: [
          { label: '越秀区', value: 'yuexiu' },
          { label: '天河区', value: 'tianhe' }
        ]
      },
      {
        label: '深圳市',
        value: 'shenzhen',
        children: [
          { label: '南山区', value: 'nanshan' },
          { label: '福田区', value: 'futian' }
        ]
      }
    ]
  }
];

// 单选模式
const showSingle = ref(false);
const singleValue = ref('');

// 多选模式
const showMultiple = ref(false);
const multipleValue = ref<string[]>([]);

// 限制选择数量模式
const showLimited = ref(false);
const limitedValue = ref<string[]>([]);

// 单选事件处理
const onSingleChange = (value: string, selectedOptions: any[]) => {
  console.log('单选值变化:', value, selectedOptions);
};

const onSingleFinish = () => {
  console.log('单选完成:', singleValue.value);
  showSingle.value = false;
};

// 多选事件处理
const onMultipleChange = (values: string[], selectedOptions: any[]) => {
  console.log('多选值变化:', values, selectedOptions);
};

const onMultipleFinish = () => {
  console.log('多选完成:', multipleValue.value);
  showMultiple.value = false;
};

// 限制选择数量事件处理
const onLimitedChange = (values: string[], selectedOptions: any[]) => {
  console.log('限制多选值变化:', values, selectedOptions);
};

const onLimitedFinish = () => {
  console.log('限制多选完成:', limitedValue.value);
  showLimited.value = false;
};
</script>

<style lang="scss" scoped>
.test-cascader-page {
  padding: 20rpx;
  background-color: #f5f5f5;
  min-height: 100vh;
}

.header {
  text-align: center;
  padding: 40rpx 0;
  
  .title {
    font-size: 36rpx;
    font-weight: bold;
    color: #333;
  }
}

.test-section {
  background-color: #fff;
  border-radius: 16rpx;
  padding: 30rpx;
  margin-bottom: 30rpx;
  box-shadow: 0 2rpx 10rpx rgba(0, 0, 0, 0.1);
  
  .section-title {
    font-size: 32rpx;
    font-weight: bold;
    color: #333;
    margin-bottom: 20rpx;
    border-left: 6rpx solid #007aff;
    padding-left: 20rpx;
  }
  
  .test-item {
    .test-btn {
      width: 100%;
      background-color: #007aff;
      color: #fff;
      border: none;
      border-radius: 12rpx;
      padding: 24rpx;
      font-size: 28rpx;
      margin-bottom: 20rpx;
      
      &:active {
        background-color: #0056cc;
      }
    }
    
    .result {
      background-color: #f8f9fa;
      border-radius: 12rpx;
      padding: 20rpx;
      border-left: 4rpx solid #28a745;
      
      text {
        display: block;
        font-size: 26rpx;
        color: #333;
        margin-bottom: 10rpx;
        
        &:last-child {
          margin-bottom: 0;
        }
      }
    }
  }
}
</style>
