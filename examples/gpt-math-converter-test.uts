/**
 * GPT 风格数学公式转换工具测试
 * 测试各种 GPT 生成的数学公式格式转换
 */

import { 
	convertGptStyleMath, 
	hasGptStyleMath, 
	findGptStyleMath, 
	convertToMpHtmlFormat,
	batchConvertMathFormulas 
} from '@/utils/gptMathConverter.uts'

/**
 * 测试 GPT 风格数学公式转换
 */
export function testGptMathConverter() {
	console.log('=== GPT 风格数学公式转换测试 ===')
	
	// 测试 1: 基本转换功能
	testBasicConversion()
	
	// 测试 2: 检测功能
	testDetection()
	
	// 测试 3: 位置查找功能
	testPositionFinding()
	
	// 测试 4: mp-html 格式转换
	testMpHtmlFormat()
	
	// 测试 5: 批量转换功能
	testBatchConversion()
	
	console.log('=== 测试完成 ===')
}

/**
 * 测试基本转换功能
 */
function testBasicConversion() {
	console.log('\n--- 基本转换功能测试 ---')
	
	const testCases = [
		{
			input: '(\\frac{a}{b} + \\frac{c}{d})',
			expected: '\\(\\frac{a}{b} + \\frac{c}{d}\\)',
			description: 'GPT 行内公式'
		},
		{
			input: '([\\sum_{i=1}^{n} x_i = x_1 + x_2 + \\cdots + x_n])',
			expected: '\\[\\sum_{i=1}^{n} x_i = x_1 + x_2 + \\cdots + x_n\\]',
			description: 'GPT 块级公式'
		},
		{
			input: '混合文本 (\\alpha + \\beta) 和 (\\[\\int f(x) dx\\]) 公式',
			expected: '混合文本 \\(\\alpha + \\beta\\) 和 \\(\\int f(x) dx\\) 公式',
			description: '混合文本中的公式'
		}
	]
	
	testCases.forEach((testCase, index) => {
		const result = convertGptStyleMath(testCase.input)
		const passed = result === testCase.expected
		
		console.log(`测试 ${index + 1}: ${testCase.description}`)
		console.log(`  输入: ${testCase.input}`)
		console.log(`  输出: ${result}`)
		console.log(`  期望: ${testCase.expected}`)
		console.log(`  结果: ${passed ? '✅ 通过' : '❌ 失败'}`)
		console.log('')
	})
}

/**
 * 测试检测功能
 */
function testDetection() {
	console.log('\n--- 检测功能测试 ---')
	
	const testCases = [
		{
			input: '普通文本',
			expected: false,
			description: '普通文本'
		},
		{
			input: '(\\frac{a}{b})',
			expected: true,
			description: '包含 GPT 行内公式'
		},
		{
			input: '([\\sum x_i])',
			expected: true,
			description: '包含 GPT 块级公式'
		},
		{
			input: '混合 (\\alpha) 和 ([\\beta]) 公式',
			expected: true,
			description: '混合公式'
		}
	]
	
	testCases.forEach((testCase, index) => {
		const result = hasGptStyleMath(testCase.input)
		const passed = result === testCase.expected
		
		console.log(`测试 ${index + 1}: ${testCase.description}`)
		console.log(`  输入: ${testCase.input}`)
		console.log(`  检测结果: ${result}`)
		console.log(`  期望: ${testCase.expected}`)
		console.log(`  结果: ${passed ? '✅ 通过' : '❌ 失败'}`)
		console.log('')
	})
}

/**
 * 测试位置查找功能
 */
function testPositionFinding() {
	console.log('\n--- 位置查找功能测试 ---')
	
	const testText = '这是第一个公式 (\\frac{a}{b}) 和第二个公式 ([\\sum x_i]) 的测试'
	const formulas = findGptStyleMath(testText)
	
	console.log(`测试文本: ${testText}`)
	console.log(`找到 ${formulas.length} 个公式:`)
	
	formulas.forEach((formula, index) => {
		console.log(`  公式 ${index + 1}:`)
		console.log(`    类型: ${formula.type}`)
		console.log(`    位置: ${formula.start}-${formula.end}`)
		console.log(`    内容: ${formula.content}`)
		console.log(`    原始: ${formula.original}`)
		console.log('')
	})
}

/**
 * 测试 mp-html 格式转换
 */
function testMpHtmlFormat() {
	console.log('\n--- mp-html 格式转换测试 ---')
	
	const testCases = [
		{
			input: '(\\frac{a}{b})',
			displayMode: false,
			expected: '$\\(\\frac{a}{b}\\)$',
			description: 'GPT 行内公式转内联显示'
		},
		{
			input: '([\\sum x_i])',
			displayMode: true,
			expected: '$$\\(\\sum x_i\\)$$',
			description: 'GPT 块级公式转块级显示'
		}
	]
	
	testCases.forEach((testCase, index) => {
		const result = convertToMpHtmlFormat(testCase.input, testCase.displayMode)
		const passed = result === testCase.expected
		
		console.log(`测试 ${index + 1}: ${testCase.description}`)
		console.log(`  输入: ${testCase.input}`)
		console.log(`  显示模式: ${testCase.displayMode ? '块级' : '内联'}`)
		console.log(`  输出: ${result}`)
		console.log(`  期望: ${testCase.expected}`)
		console.log(`  结果: ${passed ? '✅ 通过' : '❌ 失败'}`)
		console.log('')
	})
}

/**
 * 测试批量转换功能
 */
function testBatchConversion() {
	console.log('\n--- 批量转换功能测试 ---')
	
	const testText = '第一个公式 (\\frac{a}{b}) 和第二个公式 ([\\sum x_i]) 以及第三个公式 (\\alpha + \\beta)'
	const result = batchConvertMathFormulas(testText)
	
	console.log(`原始文本: ${testText}`)
	console.log(`转换结果: ${result}`)
	console.log('')
}

/**
 * 运行所有测试
 */
export function runAllTests() {
	try {
		testGptMathConverter()
		console.log('所有测试执行完成！')
	} catch (error) {
		console.error('测试执行出错:', error)
	}
}
