<!-- import { View, Text, Image, ScrollView, Swiper, SwiperItem, Input } from '@tarojs/components'
import { useLoad, showToast } from '@tarojs/taro'
import { useState, useEffect, useRef } from 'react'
import { SquareCategoryInfo, SquarePublishedItemInfo } from '@/types/interfaces/square'
import iconMenu from '@/assets/icon_menu.png'
import AgentComponent from '@/components/AgentComponent'
import { apiPublishedAgentList, apiPublishedCategoryList } from '@/servers/square'
import { CONST_ALL } from '@/constants/common.constants'
import { SUCCESS_CODE } from '@/constants/codes.constants'
import { SquareAgentTypeEnum } from '@/types/enums/square'
import { AgentComponentTypeEnum } from '@/types/enums/agent'
import Taro from '@tarojs/taro'
import './index.less'

/**
 * æ™ºèƒ½ä½“å¹¿åœºé¡µé¢
 * @returns 
 */
export default function Index () {
  // å½“å‰åˆ†ç±»
  const [activeCategory, setActiveCategory] = useState(CONST_ALL)
  // å½“å‰swiperç´¢å¼•
  const [activeSwiperIndex, setActiveSwiperIndex] = useState(0)
  // åˆ†ç±»åˆ—è¡¨
  const [categories, setCategories] = useState<{ key: string, label: string, active: boolean }[]>([])
  // æ™ºèƒ½ä½“åˆ—è¡¨
  const [agentListMap, setAgentListMap] = useState<Record<string, SquarePublishedItemInfo[]>>({})
  // åŠ è½½çŠ¶æ€
  const [loadingMap, setLoadingMap] = useState<Record<string, boolean>>({})
  // åˆ·æ–°çŠ¶æ€
  const [refreshingMap, setRefreshingMap] = useState<Record<string, boolean>>({})
  // é¡µç 
  const [pageMap, setPageMap] = useState<Record<string, number>>({})
  // æ˜¯å¦æœ‰æ›´å¤šæ•°æ®
  const [hasMoreMap, setHasMoreMap] = useState<Record<string, boolean>>({})
  // æœç´¢å…³é”®è¯
  const [searchKeyword, setSearchKeyword] = useState('')
  // æ»šåŠ¨åˆ°å¯¹åº”çš„åˆ†ç±»æ ‡ç­¾
  const [scrollIntoView, setScrollIntoView] = useState('');
  // æœç´¢å®šæ—¶å™¨
  const searchTimeoutRef = useRef<NodeJS.Timeout | null>(null)

  // è·å–åˆ†ç±»åˆ—è¡¨
  const fetchCategories = async () => {
    const { code, data } = await apiPublishedCategoryList()
    if (code === SUCCESS_CODE) {
      // è·å–æ™ºèƒ½ä½“åˆ†ç±»åˆ—è¡¨
      const agentCategoryList = data.find((item: SquareCategoryInfo) => item.type === SquareAgentTypeEnum.Agent)?.children || [];
      // è½¬æ¢ä¸ºåˆ†ç±»åˆ—è¡¨
      const categoryData = agentCategoryList.map((item: SquareCategoryInfo) => ({
        key: item.key,
        label: item.label,
        active: false,
      }))
      setCategories([{ key: CONST_ALL, label: 'å…¨éƒ¨', active: true }, ...categoryData])
    } else {
      showToast({
        title: 'è·å–åˆ†ç±»ä¿¡æ¯å¤±è´¥',
        icon: 'error'
      })
    }
  }

  // è·å–æ™ºèƒ½ä½“åˆ—è¡¨
  const fetchAgentList = async (category: string = CONST_ALL, pageNum: number = 1, keyword: string = searchKeyword) => {
    if (loadingMap[category]) return
    // è®¾ç½®åŠ è½½çŠ¶æ€
    setLoadingMap(prev => ({ ...prev, [category]: true }))
    const params = {
      targetType: AgentComponentTypeEnum.Agent,
      page: pageNum,
      pageSize: 10,
      category: category === CONST_ALL ? '' : category,
      kw: keyword,
    }
    // è·å–æ™ºèƒ½ä½“åˆ—è¡¨
    const {code, data, message}  = await apiPublishedAgentList(params)
    // æˆåŠŸ
    if (code === SUCCESS_CODE) {
      const newList = data.records || []
      if (pageNum > 1) {
        setAgentListMap(prev => ({
          ...prev,
          [category]: [...(prev[category] || []), ...newList]
        }))
      } else {
        setAgentListMap(prev => ({
          ...prev,
          [category]: newList
        }))
      }
      setHasMoreMap(prev => ({
        ...prev,
        [category]: newList.length === 10
      }))
      setPageMap(prev => ({
        ...prev,
        [category]: pageNum
      }))
    } else {
      showToast({
        title: message,
        icon: 'error'
      })
    }
    setLoadingMap(prev => ({ ...prev, [category]: false }))
  }

  useLoad(() => {
    fetchCategories()
    // é¢„åŠ è½½ç¬¬ä¸€ä¸ªåˆ†ç±»çš„æ•°æ®
    fetchAgentList()
  })

  // æ¸…ç†å®šæ—¶å™¨
  useEffect(() => {
    return () => {
      if (searchTimeoutRef.current) {
        clearTimeout(searchTimeoutRef.current)
      }
    }
  }, [searchTimeoutRef])

  // ç‚¹å‡»æ™ºèƒ½ä½“åˆ†ç±»æ ‡ç­¾
  const handleCategoryClick = (key: string, index: number) => {
    setActiveCategory(key)
    setActiveSwiperIndex(index)
    // æ»šåŠ¨åˆ°å¯¹åº”çš„åˆ†ç±»æ ‡ç­¾
    setScrollIntoView(key);
    
    // å°ç¨‹åºç«¯ï¼Œç‚¹å‡»åˆ†ç±»æ ‡ç­¾æ—¶ï¼Œæ‰åŠ è½½æ•°æ®ï¼ŒH5ç«¯ï¼Œç‚¹å‡»åˆ†ç±»æ ‡ç­¾æ—¶ï¼Œä¸åŠ è½½æ•°æ®ï¼Œå› ä¸ºh5ç«¯ï¼Œåœ¨swiperåˆ‡æ¢æ—¶ï¼Œä¼šè‡ªåŠ¨åŠ è½½æ•°æ®
    if (process.env.TARO_ENV === 'weapp') {
      // å¦‚æœè¯¥åˆ†ç±»è¿˜æ²¡æœ‰æ•°æ®ï¼Œåˆ™åŠ è½½æ•°æ®
      if (!agentListMap[key] || agentListMap[key].length === 0) {
        setPageMap(prev => ({ ...prev, [key]: 1 }))
        setHasMoreMap(prev => ({ ...prev, [key]: true }))
        fetchAgentList(key)
      }
    }
  }
  
  // å¤„ç†Swiperåˆ‡æ¢
  const handleSwiperChange = (e: any) => {
    const index = e.detail.current
    const category = categories[index]
    if (category && category.key !== activeCategory) {
      setActiveCategory(category.key)
      setActiveSwiperIndex(index)

      // æ»šåŠ¨åˆ°å¯¹åº”çš„åˆ†ç±»æ ‡ç­¾
      const id = categories[index].key
      setScrollIntoView(id);

      // å¦‚æœè¯¥åˆ†ç±»è¿˜æ²¡æœ‰æ•°æ®ï¼Œåˆ™åŠ è½½æ•°æ®
      if (!agentListMap[category.key] || agentListMap[category.key].length === 0) {
        setPageMap(prev => ({ ...prev, [category.key]: 1 }))
        setHasMoreMap(prev => ({ ...prev, [category.key]: true }))
        fetchAgentList(category.key)
      }
    }
  }

  // å¤„ç†æœç´¢
  const handleSearch = (keyword: string) => {
    setSearchKeyword(keyword)
    
    // æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨
    if (searchTimeoutRef.current) {
      clearTimeout(searchTimeoutRef.current)
    }
    
    // è®¾ç½®æ–°çš„å®šæ—¶å™¨ï¼Œé˜²æŠ–500ms
    searchTimeoutRef.current = setTimeout(() => {
      setPageMap(prev => ({ ...prev, [activeCategory]: 1 }))
      setHasMoreMap(prev => ({ ...prev, [activeCategory]: true }))
      fetchAgentList(activeCategory, 1, keyword)
    }, 500)
  }

  // è·³è½¬åˆ°æ™ºèƒ½ä½“è¯¦æƒ…é¡µ
  const handleAgentClick = (agent: SquarePublishedItemInfo) => {
    Taro.navigateTo({
      url: `/pages/agent-detail/index?id=${agent.id}`
    })
  }

  // ä¸‹æ‹‰åˆ·æ–°
  const handleRefresh = () => {
    if (refreshingMap[activeCategory]) {
      return
    }
    setRefreshingMap(prev => ({ ...prev, [activeCategory]: true }))
    setPageMap(prev => ({ ...prev, [activeCategory]: 1 }))
    setHasMoreMap(prev => ({ ...prev, [activeCategory]: true }))
    fetchAgentList(activeCategory).finally(() => {
      setRefreshingMap(prev => ({ ...prev, [activeCategory]: false }))
    })
  }

  // åŠ è½½æ›´å¤š
  const handleLoadMore = () => {
    const currentPage = pageMap[activeCategory] || 1
    const currentHasMore = hasMoreMap[activeCategory] !== false
    const currentLoading = loadingMap[activeCategory]
    
    if (currentHasMore && !currentLoading) {
      fetchAgentList(activeCategory, currentPage + 1)
    }
  }

  // è®¡ç®—å½“å‰åˆ†ç±»çš„åŠ è½½çŠ¶æ€
  // const currentLoading = useMemo(() => loadingMap[activeCategory] || false, [loadingMap, activeCategory])
  // const currentRefreshing = useMemo(() => refreshingMap[activeCategory] || false, [refreshingMap, activeCategory])
  // const currentHasMore = useMemo(() => hasMoreMap[activeCategory] !== false, [hasMoreMap, activeCategory])
  // const currentAgentList = useMemo(() => agentListMap[activeCategory] || [], [agentListMap, activeCategory])

  return (
    <View className='container'>
      {/* é¡¶éƒ¨å¯¼èˆªæ  */}
      <View className='header'>
        <View className='menu-box'>
          <Image src={iconMenu} className='image' />
        </View>
        <Text className='title'>æ™ºèƒ½ä½“</Text>
        <View className='header-right'></View>
      </View>

      {/* æœç´¢æ¡† */}
      <View className='search-container'>
        <View className='search-box'>
          <Text className='search-icon'>ğŸ”</Text>
          <Input
            className='search-input'
            placeholder='æœç´¢æ™ºèƒ½ä½“'
            value={searchKeyword}
            onInput={(e) => handleSearch(e.detail.value)}
          />
          {searchKeyword && (
            <Text 
              className='clear-icon'
              onClick={() => handleSearch('')}
            >
              âœ•
            </Text>
          )}
        </View>
      </View>

      {/* åˆ†ç±»å¯¼èˆª */}
      <View className='category-nav'>
        <ScrollView 
          className='category-scroll' 
          scrollX
          scrollWithAnimation
          scrollIntoView={scrollIntoView}
          enhanced
          showScrollbar={false}
        >
          <View className='category-list'>
            {categories.map((category, index) => (
              <View
                id={category.key}
                key={category.key}
                className={`category-item ${activeCategory === category.key ? 'active' : ''}`}
                onClick={() => handleCategoryClick(category.key, index)}
              >
                <Text className='category-text'>{category.label}</Text>
              </View>
            ))}
          </View>
        </ScrollView>
      </View>

      {/* æ¨å¹¿æ¨ªå¹… */}
      <View className='banner'>
        <View className='banner-content'>
          <Text className='banner-title'>äººäººéƒ½æ˜¯æ™ºèƒ½è®¾è®¡å¸ˆ</Text>
          <Text className='banner-desc'>
            æ–°ä¸€ä»£AIåº”ç”¨è®¾è®¡ã€å¼€å‘ã€å®è·µå¹³å°,æ— éœ€ä»£ç ,è½»æ¾åˆ›å»º,é€‚åˆå„ç±»äººç¾¤,æ”¯æŒå¤šç§ç«¯å‘å¸ƒåŠAPI
          </Text>
        </View>
      </View>

      {/* æ»šåŠ¨éƒ¨åˆ† */}
      <View className='scroll-section'>
        <Swiper 
          className='agent-swiper'
          current={activeSwiperIndex}
          onChange={handleSwiperChange}
          indicatorDots={false}
        >
            {categories.map((category) => (
              <SwiperItem key={category.key} className='swiper-item'>
                <ScrollView 
                  className='agent-scroll' 
                  scrollY 
                  onScrollToLower={handleLoadMore}
                  refresherEnabled={true}
                  refresherTriggered={refreshingMap[category.key] || false}
                  onRefresherRefresh={handleRefresh}
                  enhanced
                  showScrollbar={false}
                >
                  <View className='agent-list-container'>
                    {(agentListMap[category.key] || []).length > 0 ? (
                     (agentListMap[category.key] || []).map((info) => (
                      <AgentComponent key={info.id} agentInfo={info} onClick={() => handleAgentClick(info)} />
                    ))) : !loadingMap[category.key] ? (
                     <View className='empty-state'>
                       <Text className='empty-text'>æš‚æ— æ•°æ®</Text>
                     </View>
                   ) : null}
                   
                   {loadingMap[category.key] && (
                     <View className='loading-state'>
                       <Text className='loading-text'>åŠ è½½ä¸­...</Text>
                     </View>
                   )}
                   
                   {!loadingMap[category.key] && !hasMoreMap[category.key] && (agentListMap[category.key] || []).length > 0 && (
                     <View className='no-more-state'>
                       <Text className='no-more-text'>æ²¡æœ‰æ›´å¤šæ•°æ®äº†</Text>
                     </View>
                   )}
                </View>
              </ScrollView>
            </SwiperItem>
          ))}
        </Swiper>
      </View>
    </View>
  )
 -->}

<template>
	<view>
		<image class="logo" src="/static/logo.png"></image>
		<text class="title">{{title}}424å‘æ­å˜æ˜¯ä¸ª</text>
	</view>
</template>

<script>
	export default {
		data() {
			return {
				title: 'Hello'
			}
		},
		onLoad() {

		},
		methods: {

		}
	}
</script>

<style lang="less">
	.logo {
		height: 100px;
		width: 100px;
		margin: 100px auto 25px auto;
	}

	.title {
		font-size: 18px;
		color: #8f8f94;
    text-align: center;
	}
	
	
	.container {
	  height: 100vh;
	  display: flex;
	  flex-direction: column;
	  overflow: hidden;
	  background-color: #fff;
	}
	
	/* é¡¶éƒ¨å¯¼èˆªæ  */
	.header {
	  display: flex;
	  align-items: center;
	  justify-content: space-between;
	  padding: 4px 8px;
	
	  .menu-box {
	    display: flex;
	    align-items: center;
	    justify-content: center;
	    width: 40px;
	    height: 40px;
	
	    .image {
	      width: 24px;
	      height: 24px;
	    }
	  }
	
	  .title {
	    font-size: 16px;
	    font-weight: 600;
	    color: #15171F;
	    flex: 1;
	    text-align: center;
	  }
	
	  .header-right {
	    width: 24px;
	  }
	}
	
	/* æœç´¢æ¡† */
	.search-container {
	  padding: 12px 16px;
	  flex-shrink: 0;
	
	  .search-box {
	    display: flex;
	    align-items: center;
	    background-color: #f5f5f5;
	    border-radius: 20px;
	    padding: 8px 12px;
	    position: relative;
	
	    .search-icon {
	      font-size: 16px;
	      color: #999;
	      margin-right: 8px;
	    }
	    
	    .search-input {
	      flex: 1;
	      border: none;
	      background: transparent;
	      font-size: 14px;
	      color: #333;
	      outline: none;
	
	      &::placeholder {
	        color: #999;
	      }
	    }
	
	    .clear-icon {
	      font-size: 14px;
	      color: #999;
	      cursor: pointer;
	      padding: 2px;
	      border-radius: 50%;
	      transition: all 0.3s ease;
	
	      &:hover {
	        background-color: #e8e8e8;
	        color: #666;
	      }
	    }
	  }
	}
	
	.category-nav {
	  padding: 0 16px;
	
	  /* åˆ†ç±»å¯¼èˆª */
	  .category-scroll {
	    white-space: nowrap;
	    scroll-behavior: smooth;
	    -webkit-overflow-scrolling: touch;
	  }
	
	  .category-list {
	    height: 56px;
	    gap: 8px; 
	    display: flex;
	    align-items: center;
	
	    .category-item {
	      display: flex;
	      align-items: center;
	      height: 40px;
	      padding: 0 16px;
	      border-radius: 8px;
	      cursor: pointer;
	      transition: all 0.3s ease;
	      user-select: none;
	      color: #5E6470;
	      font-size: 16px;
	      font-weight: 400;
	    
	      &.active {
	        background-color: #F2F2FF;
	    
	        .category-text {
	          color: #5147FF;
	        }
	      }
	    
	      .category-text {
	        font-size: 16px;
	        font-weight: 400;
	        color: #5E6470;
	        transition: color 0.3s ease;
	      }
	    }
	  }
	}
	
	/* æ¨å¹¿æ¨ªå¹… */
	.banner {
	  margin: 16px;
	  border-radius: 12px;
	  overflow: hidden;
	  background: linear-gradient(135deg, #8b5cf6 0%, #f97316 100%);
	  box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
	  flex-shrink: 0;
	
	  .banner-content {
	    padding: 20px;
	    color: #fff;
	  }
	
	  .banner-title {
	    display: block;
	    font-size: 18px;
	    font-weight: 600;
	    margin-bottom: 8px;
	    line-height: 1.4;
	  }
	
	  .banner-desc {
	    display: block;
	    font-size: 13px;
	    line-height: 1.5;
	    opacity: 0.9;
	  }
	}
	
	/* æ»šåŠ¨éƒ¨åˆ† */
	.scroll-section {
	  flex: 1;
	  overflow: hidden;
	
	  /* æ™ºèƒ½ä½“åˆ—è¡¨ */
	  .agent-swiper {
	    height: 100%;
	  }
	
	  .swiper-item {
	    height: 100%;
	    overflow: hidden;
	  }
	
	  .agent-scroll {
	    height: 100%;
	  }
	
	  .agent-list-container {
	    padding: 0 16px 20px 16px;
	  }
	}
	
	/* ç©ºçŠ¶æ€ */
	.empty-state {
	  display: flex;
	  flex-direction: column;
	  align-items: center;
	  justify-content: center;
	  padding: 80px 20px;
	  text-align: center;
	}
	
	.empty-text {
	  font-size: 14px;
	  color: #999;
	  margin-top: 16px;
	}
	
	/* åŠ è½½çŠ¶æ€ */
	.loading-state {
	  display: flex;
	  align-items: center;
	  justify-content: center;
	  padding: 20px;
	}
	
	.loading-text {
	  font-size: 14px;
	  color: #666;
	  display: flex;
	  align-items: center;
	}
	
	.loading-text::before {
	  content: '';
	  width: 16px;
	  height: 16px;
	  border: 2px solid #e8e8e8;
	  border-top: 2px solid #8b5cf6;
	  border-radius: 50%;
	  animation: spin 1s linear infinite;
	  margin-right: 8px;
	}
	
	@keyframes spin {
	  0% { transform: rotate(0deg); }
	  100% { transform: rotate(360deg); }
	}
	
	/* æ²¡æœ‰æ›´å¤šæ•°æ®çŠ¶æ€ */
	.no-more-state {
	  display: flex;
	  align-items: center;
	  justify-content: center;
	  padding: 20px;
	}
	
	.no-more-text {
	  font-size: 12px;
	  color: #999;
	}
</style>
